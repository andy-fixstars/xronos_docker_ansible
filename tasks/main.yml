---
- name: apt update cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600 # 1 hr
  become: true

- name: Install docker engine
  ansible.builtin.import_tasks: docker-ce.yml

- name: Configure docker daemon for containerd-snapshotter
  ansible.builtin.import_tasks: daemon-containerd.yml
  when: docker_multiarch

- name: Install and configure qemu
  ansible.builtin.import_tasks: qemu.yml
  when: docker_multiarch

- name: Configure docker buildx builder
  ansible.builtin.import_tasks: builder.yml
  when: docker_multiarch

- name: Configure docker authentication
  ansible.builtin.import_tasks: auth.yml
  when: docker_auth != ""

- name: docker prune
  community.docker.docker_prune:
    builder_cache: true
    containers: true
    images: true
    networks: true
    volumes: true
  when: docker_prune
  become: true  # allows pruning even if ansible_user
                # is not yet a member of docker group
